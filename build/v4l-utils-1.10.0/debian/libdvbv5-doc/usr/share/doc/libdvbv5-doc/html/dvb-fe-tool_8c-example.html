<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>libdvbv5: dvb-fe-tool.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">libdvbv5
   &#160;<span id="projectnumber">1.10.0</span>
   </div>
   <div id="projectbrief">Library to work with Digital TV devices on Linux</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">dvb-fe-tool.c</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><span class="comment">/*</span></div><div class="line"><span class="comment"> * Copyright (c) 2011-2012 - Mauro Carvalho Chehab</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is free software; you can redistribute it and/or</span></div><div class="line"><span class="comment"> * modify it under the terms of the GNU General Public License</span></div><div class="line"><span class="comment"> * as published by the Free Software Foundation version 2</span></div><div class="line"><span class="comment"> * of the License.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * This program is distributed in the hope that it will be useful,</span></div><div class="line"><span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div><div class="line"><span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div><div class="line"><span class="comment"> * GNU General Public License for more details.</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> * You should have received a copy of the GNU General Public License</span></div><div class="line"><span class="comment"> * along with this program; if not, write to the Free Software</span></div><div class="line"><span class="comment"> * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA</span></div><div class="line"><span class="comment"> * Or, point your browser to http://www.gnu.org/licenses/old-licenses/gpl-2.0.html</span></div><div class="line"><span class="comment"> *</span></div><div class="line"><span class="comment"> */</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="dvb-file_8h.html">libdvbv5/dvb-file.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &lt;config.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;argp.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;signal.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdlib.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdio.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;unistd.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef ENABLE_NLS</span></div><div class="line"><span class="preprocessor"># define _(string) gettext(string)</span></div><div class="line"><span class="preprocessor"># include &quot;gettext.h&quot;</span></div><div class="line"><span class="preprocessor"># include &lt;locale.h&gt;</span></div><div class="line"><span class="preprocessor"># include &lt;langinfo.h&gt;</span></div><div class="line"><span class="preprocessor"># include &lt;iconv.h&gt;</span></div><div class="line"><span class="preprocessor">#else</span></div><div class="line"><span class="preprocessor"># define _(string) string</span></div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line"><span class="preprocessor"># define N_(string) string</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define PROGRAM_NAME    &quot;dvb-fe-tool&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *argp_program_version = PROGRAM_NAME <span class="stringliteral">&quot; version &quot;</span> V4L_UTILS_VERSION;</div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span> *argp_program_bug_address = <span class="stringliteral">&quot;Mauro Carvalho Chehab &lt;m.chehab@samsung.com&gt;&quot;</span>;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> doc[] = N_(</div><div class="line">        <span class="stringliteral">&quot;\nA DVB frontend tool using API version 5\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;\nOn the options below, the arguments are:\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;  ADAPTER      - the dvb adapter to control\n&quot;</span></div><div class="line">        <span class="stringliteral">&quot;  FRONTEND     - the dvb frontend to control&quot;</span>);</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>argp_option options[] = {</div><div class="line">        {<span class="stringliteral">&quot;verbose&quot;</span>,     <span class="charliteral">&#39;v&#39;</span>,    0,              0,      N_(<span class="stringliteral">&quot;enables debug messages&quot;</span>), 0},</div><div class="line">        {<span class="stringliteral">&quot;adapter&quot;</span>,     <span class="charliteral">&#39;a&#39;</span>,    N_(<span class="stringliteral">&quot;ADAPTER&quot;</span>),  0,      N_(<span class="stringliteral">&quot;dvb adapter&quot;</span>), 0},</div><div class="line">        {<span class="stringliteral">&quot;frontend&quot;</span>,    <span class="charliteral">&#39;f&#39;</span>,    N_(<span class="stringliteral">&quot;FRONTEND&quot;</span>), 0,      N_(<span class="stringliteral">&quot;dvb frontend&quot;</span>), 0},</div><div class="line">        {<span class="stringliteral">&quot;set-delsys&quot;</span>,  <span class="charliteral">&#39;d&#39;</span>,    N_(<span class="stringliteral">&quot;PARAMS&quot;</span>),   0,      N_(<span class="stringliteral">&quot;set delivery system&quot;</span>), 0},</div><div class="line">        {<span class="stringliteral">&quot;femon&quot;</span>,       <span class="charliteral">&#39;m&#39;</span>,    0,              0,      N_(<span class="stringliteral">&quot;monitors frontend stats on an streaming frontend&quot;</span>), 0},</div><div class="line">        {<span class="stringliteral">&quot;acoustical&quot;</span>,  <span class="charliteral">&#39;A&#39;</span>,    0,              0,      N_(<span class="stringliteral">&quot;bips if signal quality is good. Also enables femon mode. Please notice that console bip should be enabled on your wm.&quot;</span>), 0},</div><div class="line"><span class="preprocessor">#if 0 </span><span class="comment">/* Currently not implemented */</span><span class="preprocessor"></span></div><div class="line">        {<span class="stringliteral">&quot;set&quot;</span>,         <span class="charliteral">&#39;s&#39;</span>,    N_(<span class="stringliteral">&quot;PARAMS&quot;</span>),   0,      N_(<span class="stringliteral">&quot;set frontend&quot;</span>), 0},</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        {<span class="stringliteral">&quot;get&quot;</span>,         <span class="charliteral">&#39;g&#39;</span>,    0,              0,      N_(<span class="stringliteral">&quot;get frontend&quot;</span>), 0},</div><div class="line">        {<span class="stringliteral">&quot;dvbv3&quot;</span>,       <span class="charliteral">&#39;3&#39;</span>,    0,              0,      N_(<span class="stringliteral">&quot;Use DVBv3 only&quot;</span>), 0},</div><div class="line">        {<span class="stringliteral">&quot;help&quot;</span>,        <span class="charliteral">&#39;?&#39;</span>,    0,              0,      N_(<span class="stringliteral">&quot;Give this help list&quot;</span>), -1},</div><div class="line">        {<span class="stringliteral">&quot;usage&quot;</span>,       -3,     0,              0,      N_(<span class="stringliteral">&quot;Give a short usage message&quot;</span>)},</div><div class="line">        {<span class="stringliteral">&quot;version&quot;</span>,     <span class="charliteral">&#39;V&#39;</span>,    0,              0,      N_(<span class="stringliteral">&quot;Print program version&quot;</span>), -1},</div><div class="line">        { 0, 0, 0, 0, 0, 0 }</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> adapter = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> frontend = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keyword">get</span> = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">char</span> *set_params = NULL;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> verbose = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> dvbv3 = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> delsys = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> femon = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> acoustical = 0;</div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> timeout_flag = 0;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> do_timeout(<span class="keywordtype">int</span> x)</div><div class="line">{</div><div class="line">        (void)x;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (timeout_flag == 0) {</div><div class="line">                timeout_flag = 1;</div><div class="line">                alarm(2);</div><div class="line">                signal(SIGALRM, do_timeout);</div><div class="line">        } <span class="keywordflow">else</span> {</div><div class="line">                <span class="comment">/* something has gone wrong ... exit */</span></div><div class="line">                exit(1);</div><div class="line">        }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="preprocessor">#define PERROR(x...)                                                    \</span></div><div class="line"><span class="preprocessor">        do {                                                            \</span></div><div class="line"><span class="preprocessor">                fprintf(stderr, _(&quot;ERROR: &quot;));                          \</span></div><div class="line"><span class="preprocessor">                fprintf(stderr, x);                                     \</span></div><div class="line"><span class="preprocessor">                fprintf(stderr, &quot; (%s)\n&quot;, strerror(errno));            \</span></div><div class="line"><span class="preprocessor">        } while (0)</span></div><div class="line"></div><div class="line"><span class="keyword">static</span> error_t parse_opt(<span class="keywordtype">int</span> k, <span class="keywordtype">char</span> *arg, <span class="keyword">struct</span> argp_state *state)</div><div class="line">{</div><div class="line">        <span class="keywordflow">switch</span> (k) {</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;a&#39;</span>:</div><div class="line">                adapter = atoi(arg);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;f&#39;</span>:</div><div class="line">                frontend = atoi(arg);</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;d&#39;</span>:</div><div class="line">                delsys = <a name="a0"></a><a class="code" href="group__file.html#gafd50356ff0c41ccdeb560c7c447f2526">dvb_parse_delsys</a>(arg);</div><div class="line">                <span class="keywordflow">if</span> (delsys &lt; 0)</div><div class="line">                        <span class="keywordflow">return</span> ARGP_ERR_UNKNOWN;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;m&#39;</span>:</div><div class="line">                femon++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;A&#39;</span>:</div><div class="line">                femon++;</div><div class="line">                acoustical++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#if 0</span></div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;s&#39;</span>:</div><div class="line">                set_params = arg;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;g&#39;</span>:</div><div class="line">                <span class="keyword">get</span>++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;3&#39;</span>:</div><div class="line">                dvbv3++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;v&#39;</span>:</div><div class="line">                verbose ++;</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;?&#39;</span>:</div><div class="line">                argp_state_help(state, state-&gt;out_stream,</div><div class="line">                                ARGP_HELP_SHORT_USAGE | ARGP_HELP_LONG</div><div class="line">                                | ARGP_HELP_DOC);</div><div class="line">                fprintf(state-&gt;out_stream, _(<span class="stringliteral">&quot;\nReport bugs to %s.\n&quot;</span>), argp_program_bug_address);</div><div class="line">                exit(0);</div><div class="line">        <span class="keywordflow">case</span> <span class="charliteral">&#39;V&#39;</span>:</div><div class="line">                fprintf (state-&gt;out_stream, <span class="stringliteral">&quot;%s\n&quot;</span>, argp_program_version);</div><div class="line">                exit(0);</div><div class="line">        <span class="keywordflow">case</span> -3:</div><div class="line">                argp_state_help(state, state-&gt;out_stream, ARGP_HELP_USAGE);</div><div class="line">                exit(0);</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">                <span class="keywordflow">return</span> ARGP_ERR_UNKNOWN;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">struct </span>argp argp = {</div><div class="line">        .options = options,</div><div class="line">        .parser = parse_opt,</div><div class="line">        .doc = doc,</div><div class="line">};</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span> print_frontend_stats(FILE *fd,</div><div class="line">                                <span class="keyword">struct</span> <a name="_a1"></a><a class="code" href="structdvb__v5__fe__parms.html">dvb_v5_fe_parms</a> *parms)</div><div class="line">{</div><div class="line">        <span class="keywordtype">char</span> buf[512], *p;</div><div class="line">        <span class="keywordtype">int</span> rc, i, len, show, n_status_lines = 0;</div><div class="line"></div><div class="line">        rc = <a name="a2"></a><a class="code" href="group__frontend.html#gafb6b35003768d938a4e1623d9fb82baa">dvb_fe_get_stats</a>(parms);</div><div class="line">        <span class="keywordflow">if</span> (rc) {</div><div class="line">                PERROR(_(<span class="stringliteral">&quot;dvb_fe_get_stats failed&quot;</span>));</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line">        }</div><div class="line"></div><div class="line">        p = buf;</div><div class="line">        len = <span class="keyword">sizeof</span>(buf);</div><div class="line">        <a name="a3"></a><a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms,  <a name="a4"></a><a class="code" href="group__frontend.html#ga6b9d1ac1e7f098f2e189408c573957a1">DTV_STATUS</a>, NULL, 0, &amp;p, &amp;len, &amp;show);</div><div class="line"></div><div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; MAX_DTV_STATS; i++) {</div><div class="line">                show = 1;</div><div class="line"></div><div class="line">                <a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms, <a name="a5"></a><a class="code" href="group__frontend.html#gaa73136f5485832d7094d3cad6885798c">DTV_QUALITY</a>, _(<span class="stringliteral">&quot;Quality&quot;</span>),</div><div class="line">                                     i, &amp;p, &amp;len, &amp;show);</div><div class="line"></div><div class="line">                <a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms, DTV_STAT_SIGNAL_STRENGTH, _(<span class="stringliteral">&quot;Signal&quot;</span>),</div><div class="line">                                     i, &amp;p, &amp;len, &amp;show);</div><div class="line"></div><div class="line">                <a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms, DTV_STAT_CNR, _(<span class="stringliteral">&quot;C/N&quot;</span>),</div><div class="line">                                     i, &amp;p, &amp;len, &amp;show);</div><div class="line"></div><div class="line">                <a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms, DTV_STAT_ERROR_BLOCK_COUNT, _(<span class="stringliteral">&quot;UCB&quot;</span>),</div><div class="line">                                     i,  &amp;p, &amp;len, &amp;show);</div><div class="line"></div><div class="line">                <a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms, <a name="a6"></a><a class="code" href="group__frontend.html#ga0a380404fc053ab72d8093a5acf60103">DTV_BER</a>, _(<span class="stringliteral">&quot;postBER&quot;</span>),</div><div class="line">                                     i,  &amp;p, &amp;len, &amp;show);</div><div class="line"></div><div class="line">                <a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms, <a name="a7"></a><a class="code" href="group__frontend.html#gade8a86029dae354c98ce75825fff8f37">DTV_PRE_BER</a>, _(<span class="stringliteral">&quot;preBER&quot;</span>),</div><div class="line">                                     i,  &amp;p, &amp;len, &amp;show);</div><div class="line"></div><div class="line">                <a class="code" href="group__frontend.html#ga5537a2ab838f8814c5d22d90c648b3d5">dvb_fe_snprintf_stat</a>(parms, <a name="a8"></a><a class="code" href="group__frontend.html#gaae80c2c97096e7cfbf5a8c2de5eb5001">DTV_PER</a>, _(<span class="stringliteral">&quot;PER&quot;</span>),</div><div class="line">                                     i,  &amp;p, &amp;len, &amp;show);</div><div class="line">                <span class="keywordflow">if</span> (p != buf) {</div><div class="line">                        <span class="keywordflow">if</span> (isatty(fileno(fd))) {</div><div class="line">                                <span class="keyword">enum</span> <a class="code" href="group__frontend.html#ga7eccef04635a4b32d251e0fa9fe43a97">dvb_quality</a> qual;</div><div class="line">                                <span class="keywordtype">int</span> color;</div><div class="line"></div><div class="line">                                qual = <a name="a9"></a><a class="code" href="group__frontend.html#ga968cca91f370fdd3942786b9f4db634e">dvb_fe_retrieve_quality</a>(parms, 0);</div><div class="line"></div><div class="line">                                <span class="keywordflow">switch</span> (qual) {</div><div class="line">                                <span class="keywordflow">case</span> <a name="a10"></a><a class="code" href="dvb-v5-std_8h.html#ga7eccef04635a4b32d251e0fa9fe43a97af370ea1484e641aad1edb197f8f92dc0">DVB_QUAL_POOR</a>:</div><div class="line">                                        color = 31;</div><div class="line">                                        <span class="keywordflow">break</span>;</div><div class="line">                                <span class="keywordflow">case</span> <a name="a11"></a><a class="code" href="dvb-v5-std_8h.html#ga7eccef04635a4b32d251e0fa9fe43a97ab019fe5c846dbad645b63788eda873ec">DVB_QUAL_OK</a>:</div><div class="line">                                        color = 36;</div><div class="line">                                        <span class="keywordflow">break</span>;</div><div class="line">                                <span class="keywordflow">case</span> <a name="a12"></a><a class="code" href="dvb-v5-std_8h.html#ga7eccef04635a4b32d251e0fa9fe43a97a5118d9312ce9b60af3c4d53a91d11642">DVB_QUAL_GOOD</a>:</div><div class="line">                                        color = 32;</div><div class="line">                                        <span class="keywordflow">break</span>;</div><div class="line">                                <span class="keywordflow">case</span> <a name="a13"></a><a class="code" href="dvb-v5-std_8h.html#ga7eccef04635a4b32d251e0fa9fe43a97a5d7dac7c1ae946e063e4674c41ff499c">DVB_QUAL_UNKNOWN</a>:</div><div class="line">                                <span class="keywordflow">default</span>:</div><div class="line">                                        color = 0;</div><div class="line">                                        <span class="keywordflow">break</span>;</div><div class="line">                                }</div><div class="line">                                fprintf(fd, <span class="stringliteral">&quot;\033[%dm&quot;</span>, color);</div><div class="line">                                <span class="comment">/*</span></div><div class="line"><span class="comment">                                 * It would be great to change the BELL</span></div><div class="line"><span class="comment">                                 * tone depending on the quality. The legacy</span></div><div class="line"><span class="comment">                                 * femon used to to that, but this doesn&#39;t</span></div><div class="line"><span class="comment">                                 * work anymore with modern Linux distros.</span></div><div class="line"><span class="comment">                                 *</span></div><div class="line"><span class="comment">                                 * So, just print a bell if quality is good.</span></div><div class="line"><span class="comment">                                 *</span></div><div class="line"><span class="comment">                                 * The console audio should be enabled</span></div><div class="line"><span class="comment">                                 * at the window manater for this to</span></div><div class="line"><span class="comment">                                 * work.</span></div><div class="line"><span class="comment">                                 */</span></div><div class="line">                                <span class="keywordflow">if</span> (acoustical) {</div><div class="line">                                        <span class="keywordflow">if</span> (qual == <a class="code" href="dvb-v5-std_8h.html#ga7eccef04635a4b32d251e0fa9fe43a97a5118d9312ce9b60af3c4d53a91d11642">DVB_QUAL_GOOD</a>)</div><div class="line">                                                fprintf(fd, <span class="stringliteral">&quot;\a&quot;</span>);</div><div class="line">                                }</div><div class="line">                        }</div><div class="line"></div><div class="line">                        <span class="keywordflow">if</span> (n_status_lines)</div><div class="line">                                fprintf(fd, <span class="stringliteral">&quot;\t%s\n&quot;</span>, buf);</div><div class="line">                        <span class="keywordflow">else</span></div><div class="line">                                fprintf(fd, <span class="stringliteral">&quot;%s\n&quot;</span>, buf);</div><div class="line"></div><div class="line">                        n_status_lines++;</div><div class="line"></div><div class="line">                        p = buf;</div><div class="line">                        len = <span class="keyword">sizeof</span>(buf);</div><div class="line">                }</div><div class="line">        }</div><div class="line"></div><div class="line">        fflush(fd);</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> get_show_stats(<span class="keyword">struct</span> <a class="code" href="structdvb__v5__fe__parms.html">dvb_v5_fe_parms</a> *parms)</div><div class="line">{</div><div class="line">        <span class="keywordtype">int</span> rc;</div><div class="line"></div><div class="line">        signal(SIGTERM, do_timeout);</div><div class="line">        signal(SIGINT, do_timeout);</div><div class="line"></div><div class="line">        <span class="keywordflow">do</span> {</div><div class="line">                rc = <a class="code" href="group__frontend.html#gafb6b35003768d938a4e1623d9fb82baa">dvb_fe_get_stats</a>(parms);</div><div class="line">                <span class="keywordflow">if</span> (!rc)</div><div class="line">                        print_frontend_stats(stderr, parms);</div><div class="line">                <span class="keywordflow">if</span> (!timeout_flag)</div><div class="line">                        usleep(1000000);</div><div class="line">        } <span class="keywordflow">while</span> (!timeout_flag);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> *argv[])</div><div class="line">{</div><div class="line">        <span class="keyword">struct </span><a class="code" href="structdvb__v5__fe__parms.html">dvb_v5_fe_parms</a> *parms;</div><div class="line">        <span class="keywordtype">int</span> fe_flags = O_RDWR;</div><div class="line"></div><div class="line"><span class="preprocessor">#ifdef ENABLE_NLS</span></div><div class="line">        setlocale (LC_ALL, <span class="stringliteral">&quot;&quot;</span>);</div><div class="line">        bindtextdomain (PACKAGE, LOCALEDIR);</div><div class="line">        textdomain (PACKAGE);</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line"></div><div class="line">        argp_parse(&amp;argp, argc, argv, ARGP_NO_HELP | ARGP_NO_EXIT, 0, 0);</div><div class="line"></div><div class="line">        <span class="comment">/*</span></div><div class="line"><span class="comment">         * If called without any option, be verbose, to print the</span></div><div class="line"><span class="comment">         * DVB frontend information.</span></div><div class="line"><span class="comment">         */</span></div><div class="line">        <span class="keywordflow">if</span> (!<span class="keyword">get</span> &amp;&amp; !delsys &amp;&amp; !set_params &amp;&amp; !femon)</div><div class="line">                <a name="a14"></a><a class="code" href="structdvb__v5__fe__parms.html#a907df1b9fd524cfb0d99ed9e50ccf799">verbose</a>++;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (!delsys &amp;&amp; !set_params)</div><div class="line">                fe_flags = O_RDONLY;</div><div class="line"></div><div class="line">        parms = <a name="a15"></a><a class="code" href="group__frontend.html#ga3b30d1e0a3d7bf3fcfad6314dc654dd3">dvb_fe_open_flags</a>(adapter, frontend, <a class="code" href="structdvb__v5__fe__parms.html#a907df1b9fd524cfb0d99ed9e50ccf799">verbose</a>, dvbv3,</div><div class="line">                                  NULL, fe_flags);</div><div class="line">        <span class="keywordflow">if</span> (!parms)</div><div class="line">                <span class="keywordflow">return</span> -1;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (delsys) {</div><div class="line">                printf(_(<span class="stringliteral">&quot;Changing delivery system to: %s\n&quot;</span>),</div><div class="line">                        delivery_system_name[delsys]);</div><div class="line">                <a name="a16"></a><a class="code" href="group__frontend.html#gaa81228d801afc6d5c293e4deb7b60e50">dvb_set_sys</a>(parms, delsys);</div><div class="line">                <span class="keywordflow">goto</span> ret;</div><div class="line">        }</div><div class="line"></div><div class="line"><span class="preprocessor">#if 0</span></div><div class="line">        <span class="keywordflow">if</span> (set_params)</div><div class="line">                do_something();</div><div class="line"><span class="preprocessor">#endif</span></div><div class="line">        <span class="keywordflow">if</span> (<span class="keyword">get</span>) {</div><div class="line">                <a name="a17"></a><a class="code" href="group__frontend.html#ga5c19c7743b1bb9acd5d7cba86b275b88">dvb_fe_get_parms</a>(parms);</div><div class="line">                <a name="a18"></a><a class="code" href="group__frontend.html#gad4004fd14c39191e532fb1bc2431946c">dvb_fe_prt_parms</a>(parms);</div><div class="line">        }</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (femon)</div><div class="line">                get_show_stats(parms);</div><div class="line"></div><div class="line">ret:</div><div class="line">        <a name="a19"></a><a class="code" href="group__frontend.html#gaa245d22bee224c452b0acbb718e70acf">dvb_fe_close</a>(parms);</div><div class="line"></div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
